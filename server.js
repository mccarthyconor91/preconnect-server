const express = require("express");
const path = require("path");

const app = express();
const PORT = process.env.PORT || 5000;

// 488 domains sorted by TLS certificate chain size (heaviest first)
const realDomains = [
  "https://www.bread.com",
  "https://www.intel.com",
  "https://www.mayoclinic.org",
  "https://www.macys.com",
  "https://www.ebay.com",
  "https://www.tesco.com",
  "https://www.ally.com",
  "https://www.sainsburys.co.uk",
  "https://www.newegg.com",
  "https://www.bing.com",
  "https://www.depositphotos.com",
  "https://www.victoriassecret.com",
  "https://www.vultr.com",
  "https://www.lidl.com",
  "https://www.westernunion.com",
  "https://www.argos.co.uk",
  "https://www.ea.com",
  "https://www.youtube.com",
  "https://www.google.com",
  "https://www.firebase.google.com",
  "https://www.cloud.google.com",
  "https://www.nordstrom.com",
  "https://www.greendot.com",
  "https://www.op.gg",
  "https://www.aliexpress.com",
  "https://www.lululemon.com",
  "https://www.reuters.com",
  "https://www.alibaba.com",
  "https://www.weibo.com",
  "https://www.bloomingdales.com",
  "https://www.atom.io",
  "https://www.usbank.com",
  "https://www.microsoft.com",
  "https://www.tdbank.com",
  "https://www.wired.com",
  "https://www.newyorker.com",
  "https://www.hp.com",
  "https://www.amazon.com",
  "https://www.pnc.com",
  "https://www.klarna.com",
  "https://www.lowes.com",
  "https://www.roblox.com",
  "https://www.nvidia.com",
  "https://www.runnersworld.com",
  "https://www.bicycling.com",
  "https://www.cisco.com",
  "https://www.samsung.com",
  "https://www.airbnb.com",
  "https://www.williams-sonoma.com",
  "https://www.westelm.com",
  "https://www.potterybarn.com",
  "https://www.gitlab.com",
  "https://www.cbsnews.com",
  "https://www.baidu.com",
  "https://www.gettyimages.com",
  "https://www.adidas.com",
  "https://www.shein.com",
  "https://www.credova.com",
  "https://www.atlassian.com",
  "https://www.tripadvisor.com",
  "https://www.2k.com",
  "https://www.splitit.com",
  "https://www.paypal.com",
  "https://www.n26.com",
  "https://www.staples.com",
  "https://www.khanacademy.org",
  "https://www.gooten.com",
  "https://www.fanatical.com",
  "https://www.target.com",
  "https://www.pinterest.com",
  "https://www.zelle.com",
  "https://www.snowflake.com",
  "https://www.engadget.com",
  "https://www.webmd.com",
  "https://www.citi.com",
  "https://www.shutterstock.com",
  "https://www.bbc.com",
  "https://www.harness.io",
  "https://www.zoom.us",
  "https://www.marksandspencer.com",
  "https://www.printful.com",
  "https://www.sofi.com",
  "https://www.currys.co.uk",
  "https://www.safeway.com",
  "https://www.albertsons.com",
  "https://www.xbox.com",
  "https://www.istockphoto.com",
  "https://www.quora.com",
  "https://www.capitalone.com",
  "https://www.zazzle.com",
  "https://www.americanexpress.com",
  "https://www.bankofamerica.com",
  "https://www.oracle.com",
  "https://www.resy.com",
  "https://www.vistaprint.com",
  "https://www.telegram.org",
  "https://www.strava.com",
  "https://www.urbanoutfitters.com",
  "https://www.activision.com",
  "https://www.anthropologie.com",
  "https://www.gamestop.com",
  "https://www.freepeople.com",
  "https://www.mozilla.org",
  "https://www.remitly.com",
  "https://www.gitpod.io",
  "https://www.nintendo.com",
  "https://www.asda.com",
  "https://www.schwab.com",
  "https://www.missguided.com",
  "https://www.nbcnews.com",
  "https://www.imdb.com",
  "https://www.cnbc.com",
  "https://www.homedepot.com",
  "https://www.dell.com",
  "https://www.blitz.gg",
  "https://www.aws.amazon.com",
  "https://www.bethesda.net",
  "https://www.singlestore.com",
  "https://www.steepandcheap.com",
  "https://www.backcountry.com",
  "https://www.wowhead.com",
  "https://www.circleci.com",
  "https://www.robinhood.com",
  "https://www.hackernews.com",
  "https://www.buildkite.com",
  "https://www.500px.com",
  "https://www.pgpool.net",
  "https://www.elastic.co",
  "https://www.jetbrains.com",
  "https://www.ubisoft.com",
  "https://www.everydayhealth.com",
  "https://www.abcnews.go.com",
  "https://www.medicalnewstoday.com",
  "https://www.codeanywhere.com",
  "https://www.gemini.com",
  "https://www.threadless.com",
  "https://www.airtable.com",
  "https://www.wsj.com",
  "https://www.morrisons.com",
  "https://www.epicgames.com",
  "https://www.databricks.com",
  "https://www.blizzard.com",
  "https://www.onemedical.com",
  "https://www.lyft.com",
  "https://www.coursera.org",
  "https://www.arstechnica.com",
  "https://www.puma.com",
  "https://www.soundcloud.com",
  "https://www.okta.com",
  "https://www.healthline.com",
  "https://www.grammarly.com",
  "https://www.deviantart.com",
  "https://www.campsaver.com",
  "https://www.figma.com",
  "https://www.brooks.com",
  "https://www.instacart.com",
  "https://www.flickr.com",
  "https://www.dribbble.com",
  "https://www.cafepress.com",
  "https://www.wine.com",
  "https://www.stackblitz.com",
  "https://www.sezzle.com",
  "https://www.nike.com",
  "https://www.monzo.com",
  "https://www.asics.com",
  "https://www.surlatable.com",
  "https://www.buddy.works",
  "https://www.pulumi.com",
  "https://www.eyeem.com",
  "https://www.pixlr.com",
  "https://www.ocado.com",
  "https://www.neo4j.com",
  "https://www.lendingclub.com",
  "https://www.influxdata.com",
  "https://www.binance.com",
  "https://www.teepublic.com",
  "https://www.duolingo.com",
  "https://www.uniqlo.com",
  "https://www.codeship.com",
  "https://www.fotor.com",
  "https://www.canva.com",
  "https://www.u.gg",
  "https://www.sony.com",
  "https://www.edx.org",
  "https://www.bloomberg.com",
  "https://www.publix.com",
  "https://www.salesforce.com",
  "https://www.linkedin.com",
  "https://www.moneygram.com",
  "https://www.oldnavy.com",
  "https://www.gap.com",
  "https://www.bananarepublic.com",
  "https://www.splunk.com",
  "https://www.restorationhardware.com",
  "https://www.ign.com",
  "https://www.huffpost.com",
  "https://www.expedia.com",
  "https://www.discover.com",
  "https://www.bowflex.com",
  "https://www.visualstudio.com",
  "https://www.snapchat.com",
  "https://www.etrade.com",
  "https://www.valvesoftware.com",
  "https://www.oceanbase.com",
  "https://www.washingtonpost.com",
  "https://www.theguardian.com",
  "https://www.rockstargames.com",
  "https://www.hotels.com",
  "https://www.patagonia.com",
  "https://www.afterpay.com",
  "https://www.foxnews.com",
  "https://www.very.co.uk",
  "https://www.prosper.com",
  "https://www.officedepot.com",
  "https://www.kinguin.net",
  "https://www.apple.com",
  "https://www.nytimes.com",
  "https://www.gnu.org",
  "https://www.underarmour.com",
  "https://www.adorama.com",
  "https://www.xoom.com",
  "https://www.synchrony.com",
  "https://www.waitrose.com",
  "https://www.venmo.com",
  "https://www.grafana.com",
  "https://www.vox.com",
  "https://www.theverge.com",
  "https://www.jcrew.com",
  "https://www.fidelity.com",
  "https://www.chase.com",
  "https://www.bestbuy.com",
  "https://www.wellsfargo.com",
  "https://www.johnlewis.com",
  "https://www.playstation.com",
  "https://www.linode.com",
  "https://www.upstart.com",
  "https://www.buzzfeed.com",
  "https://www.yelp.com",
  "https://www.traderjoes.com",
  "https://www.usatoday.com",
  "https://www.wegmans.com",
  "https://www.github.com",
  "https://www.crateandbarrel.com",
  "https://www.mcdonalds.com",
  "https://www.yahoo.com",
  "https://www.hoka.com",
  "https://www.datadoghq.com",
  "https://www.cb2.com",
  "https://www.walmart.com",
  "https://www.reddit.com",
  "https://www.bamboo.com",
  "https://www.booking.com",
  "https://www.hm.com",
  "https://www.ulta.com",
  "https://www.wise.com",
  "https://www.next.co.uk",
  "https://www.postmates.com",
  "https://www.spotify.com",
  "https://www.ubereats.com",
  "https://www.gog.com",
  "https://www.newrelic.com",
  "https://www.uber.com",
  "https://www.riotgames.com",
  "https://www.facebook.com",
  "https://www.mailchimp.com",
  "https://www.zocdoc.com",
  "https://www.etsy.com",
  "https://www.wholefoodsmarket.com",
  "https://www.whatsapp.com",
  "https://www.theatlantic.com",
  "https://www.instagram.com",
  "https://www.priceline.com",
  "https://www.netlify.com",
  "https://www.udemy.com",
  "https://www.revolve.com",
  "https://www.sephora.com",
  "https://www.vivino.com",
  "https://www.grubhub.com",
  "https://www.twitch.tv",
  "https://www.containerstore.com",
  "https://www.goodrx.com",
  "https://www.cloudflare.com",
  "https://www.totalwine.com",
  "https://www.unsplash.com",
  "https://www.prettylittlething.com",
  "https://www.bitbucket.org",
  "https://www.forbes.com",
  "https://www.bikeradar.com",
  "https://www.eurogamer.net",
  "https://www.remove.bg",
  "https://www.notion.so",
  "https://www.shipt.com",
  "https://www.pexels.com",
  "https://www.mobafire.com",
  "https://www.escapistmagazine.com",
  "https://www.redbubble.com",
  "https://www.producthunt.com",
  "https://www.timeextension.com",
  "https://www.siliconera.com",
  "https://www.gizmodo.com",
  "https://www.affirm.com",
  "https://www.singletracks.com",
  "https://www.peapod.com",
  "https://www.destructoid.com",
  "https://www.humblebundle.com",
  "https://www.digitalocean.com",
  "https://www.travis-ci.com",
  "https://www.trailspace.com",
  "https://www.trailforks.com",
  "https://www.semaphoreci.com",
  "https://www.clickhouse.com",
  "https://www.blockchain.com",
  "https://www.wikipedia.org",
  "https://www.coinbase.com",
  "https://www.artstation.com",
  "https://www.sequelize.org",
  "https://www.prometheus.io",
  "https://www.icy-veins.com",
  "https://www.giantbomb.com",
  "https://www.evo.com",
  "https://www.doordash.com",
  "https://www.codefresh.io",
  "https://www.teladoc.com",
  "https://www.stocksy.com",
  "https://www.shopify.com",
  "https://www.rpgsite.net",
  "https://www.railway.app",
  "https://www.mashable.com",
  "https://www.jsfiddle.net",
  "https://www.hubspot.com",
  "https://www.hasura.io",
  "https://www.discord.com",
  "https://www.tracker.gg",
  "https://www.replit.com",
  "https://www.quadpay.com",
  "https://www.mmorpg.com",
  "https://www.kysely.dev",
  "https://www.kotaku.com",
  "https://www.knexjs.org",
  "https://www.faceit.com",
  "https://www.codepen.io",
  "https://www.cdkeys.com",
  "https://www.redis.com",
  "https://www.neon.tech",
  "https://www.medium.com",
  "https://www.fashionnova.com",
  "https://www.cash.app",
  "https://www.vimeo.com",
  "https://www.mirror.co",
  "https://www.gymshark.com",
  "https://www.forever21.com",
  "https://www.esea.net",
  "https://www.society6.com",
  "https://www.revolut.com",
  "https://www.reebok.com",
  "https://www.g2a.com",
  "https://www.drizzle.team",
  "https://www.ao.com",
  "https://www.allbirds.com",
  "https://www.airbyte.com",
  "https://www.puppet.com",
  "https://www.typeorm.io",
  "https://www.tonal.com",
  "https://www.rothys.com",
  "https://www.render.com",
  "https://www.kraken.com",
  "https://www.gopuff.com",
  "https://www.everlane.com",
  "https://www.duckdb.org",
  "https://www.pier1.com",
  "https://www.ikea.com",
  "https://www.bevmo.com",
  "https://www.chef.io",
  "https://www.ibm.com",
  "https://www.photopea.com",
  "https://www.zara.com",
  "https://www.netflix.com",
  "https://www.stitch.com",
  "https://www.jenkins.io",
  "https://www.overstock.com",
  "https://www.bedbathandbeyond.com",
  "https://www.rockpapershotgun.com",
  "https://www.greenmangaming.com",
  "https://www.trailrunnermag.com",
  "https://www.tomshardware.com",
  "https://www.tinypng.com",
  "https://www.cyclingnews.com",
  "https://www.outsideonline.com",
  "https://www.pgbouncer.org",
  "https://www.backpacker.com",
  "https://www.vanguard.com",
  "https://www.opentable.com",
  "https://www.sublimetext.com",
  "https://www.fastly.com",
  "https://www.pcgamer.com",
  "https://www.hydrow.com",
  "https://www.behance.net",
  "https://www.vercel.com",
  "https://www.mikro-orm.io",
  "https://www.memcached.org",
  "https://www.zdnet.com",
  "https://www.slack.com",
  "https://www.brackets.io",
  "https://www.planetscale.com",
  "https://www.docker.com",
  "https://www.cnet.com",
  "https://www.bookshelfjs.org",
  "https://www.timescale.com",
  "https://www.mtbr.com",
  "https://www.worldmarket.com",
  "https://www.vg247.com",
  "https://www.teamcity.com",
  "https://www.nordictrack.com",
  "https://www.fivetran.com",
  "https://www.spreadshirt.com",
  "https://www.mongodb.com",
  "https://www.ansible.com",
  "https://www.saltstack.com",
  "https://www.bathandbodyworks.com",
  "https://www.terraform.io",
  "https://www.supabase.com",
  "https://www.datastax.com",
  "https://www.current.com",
  "https://www.glitch.com",
  "https://www.tesla.com",
  "https://www.moo.com",
  "https://www.boohoo.com",
  "https://www.prisma.io",
  "https://www.kayak.com",
  "https://www.dropbox.com",
  "https://www.starbucks.com",
  "https://www.azure.microsoft.com",
  "https://www.costco.com",
  "https://www.stripe.com",
  "https://www.newbalance.com",
  "https://www.chime.com",
  "https://www.asos.com",
  "https://www.akamai.com",
  "https://www.freshdirect.com",
  "https://www.rei.com",
  "https://www.adobe.com",
  "https://www.drugs.com",
  "https://www.cockroachlabs.com",
  "https://www.wayfair.com",
  "https://www.tiktok.com",
  "https://www.twitter.com",
  "https://www.slashdot.org",
  "https://www.arangodb.com",
  "https://www.cnn.com",
  "https://www.codesandbox.io",
  "https://www.bhphotovideo.com",
  "https://www.fluxcd.io",
  "https://www.on-running.com",
  "https://www.crossplane.io",
  "https://www.wordpress.com",
  "https://www.spinnaker.io",
  "https://www.nintendolife.com",
  "https://www.techcrunch.com",
  "https://www.sourceforge.net",
  "https://www.pinkbike.com",
  "https://www.heroku.com",
  "https://www.zendesk.com",
  "https://www.pushsquare.com",
  "https://www.gamespot.com",
  "https://www.drone.io",
  "https://www.vice.com",
  "https://www.notepad-plus-plus.org",
  "https://www.kubernetes.io",
  "https://www.dualshockers.com",
  "https://www.coder.com",
  "https://www.citusdata.com",
  "https://www.purexbox.com",
  "https://www.trivago.com",
  "https://www.vitess.io",
  "https://www.sprouts.com",
  "https://www.gearjunkie.com",
  "https://www.deno.com",
  "https://www.stackoverflow.com",
  "https://www.polygon.com",
  "https://www.couchbase.com",
  "https://www.peloton.com",
  "https://www.dreamstime.com",
  "https://www.anandtech.com",
  "https://www.yugabyte.com",
  "https://www.aldi.com",
  "https://www.fly.io",
  "https://www.tidb.io",
  "https://www.argocd.io"
];


// Serve hero image same-origin
app.use(express.static(__dirname));

app.get("/test", (req, res) => {
  const count = parseInt(req.query.preconnectCount || "0", 10);
  const selected = realDomains.slice(0, Math.min(count, realDomains.length));


  let preconnects = "";
  for (const domain of selected) {
    preconnects += `<link rel="preconnect" href="${domain}" crossorigin>\n`;
  }

  const html = `
  <!doctype html>
  <html>
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Preconnect Test (${count})</title>

      ${preconnects}

      <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        nav { background: #111; color: white; padding: 16px 32px; display: flex; justify-content: space-between; }
        nav a { color: white; text-decoration: none; margin-left: 16px; }
        .hero { width: 100%; height: 80vh; object-fit: cover; display: block; }
        .content { max-width: 800px; margin: 40px auto; padding: 0 20px; }
        .card { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
      </style>
    </head>
    <body>

      <nav>
        <div>Preconnect Test</div>
        <div>
          <a href="/test">0</a>
          <a href="/test?preconnectCount=100">100</a>
          <a href="/test?preconnectCount=300">300</a>
          <a href="/test?preconnectCount=500">500</a>
        </div>
      </nav>

      <img
        src="smallhero.jpg"
        width="1600"
        height="900"
        alt="Hero"
        class="hero"
      />

      <div class="content">
        <h1>Preconnect Count: ${count}</h1>
        <p>
          This page dynamically injects ${count} preconnect hints
          while the LCP image loads from the same origin.
        </p>

        <div class="card">
          <h2>Test Section</h2>
          <p>Used to simulate normal page content.</p>
        </div>

        <div class="card">
          <h2>Another Section</h2>
          <p>More layout content.</p>
        </div>
      </div>


    </body>
  </html>
  `;

  res.setHeader("Content-Type", "text/html");
  res.send(html);
});

app.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}`);
});
